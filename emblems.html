<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emblem Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#f8fafc;--text:#1e293b;--card:#ffffff;--accent:#3b82f6;--muted:#64748b;--border:#e2e8f0;}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);transition:all .2s;font-size:0.9rem;}
body.dark-mode{--bg:#0f172a;--text:#facc15;--card:#111827;--accent:#fbbf24;--border:#1e293b;}

header{background:#1e40af;color:#fff;padding:0.8rem 1.5rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,.08);}
header h1{margin:0;font-size:1.1rem;font-weight:600;}
.toggle-btn{background:none;border:1px solid var(--accent);color:var(--accent);padding:0.3rem 0.6rem;border-radius:6px;cursor:pointer;font-size:0.8rem;font-weight:600;}

nav{display:flex;justify-content:center;gap:8px;padding:0.6rem;background:#e2e8f0;flex-wrap:wrap;}
nav a{color:#fff;text-decoration:none;padding:0.5rem 0.9rem;background:var(--accent);border-radius:6px;font-weight:600;font-size:0.85rem;}
nav a:hover{opacity:0.9;transform:translateY(-1px);}

main{max-width:800px;margin:1.5rem auto;padding:0 1rem;}
.table-container{background:var(--card);border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.05);overflow:hidden;border:1px solid var(--border);}

table{width:100%;border-collapse:collapse;}
th{background:#f1f5f9;font-weight:600;text-align:left;color:var(--muted);text-transform:uppercase;font-size:0.75rem;letter-spacing:0.05em;}
th,td{padding:0.75rem 1rem;border-bottom:1px solid var(--border);}
tr:last-child td{border-bottom:none;}
tr:hover{background:rgba(59,130,246,0.02);}

.player-name{font-weight:600;color:var(--text);}
.count-cell{display:flex;align-items:center;gap:1rem;justify-content:flex-end;}
.count-val{font-weight:700;font-size:1.1rem;min-width:30px;text-align:center;}

.btn-sm{width:28px;height:28px;border-radius:6px;border:none;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:1.1rem;}
.btn-minus{background:#ef4444;}
.btn-plus{background:#10b981;}
.btn-sm:hover{opacity:0.8;}
.btn-sm:active{transform:scale(0.9);}

.status-msg{text-align:center;padding:3rem;color:var(--muted);font-size:0.85rem;}

body.dark-mode th{background:#1e293b;color:var(--accent);}
</style>
</head>
<body>

<header>
  <h1>Emblem Tracker</h1>
  <button class="toggle-btn" id="darkToggle">Dark Mode</button>
</header>

<nav>
  <a href="index.html">Dashboard</a>
  <a href="trends.html">Trends</a>
  <a href="emblems.html">Emblems</a>
  <a href="form.html">Add Data</a>
  <a href="config.html">Config</a>
</nav>

<main>
  <div class="table-container" id="tableContent">
      <div class="status-msg">Loading players...</div>
  </div>
</main>

<script>
const DATA_KEY = 'formData';
const EMBLEM_KEY = 'emblemData';

// 1. Get Names from Dashboard Data
function getPlayerNames() {
    try {
        const raw = localStorage.getItem(DATA_KEY);
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return [...new Set(parsed.map(item => item.name))].filter(Boolean).sort();
    } catch (e) {
        return [];
    }
}

// 2. Load/Save Emblem Counts
function getEmblemCounts() {
    try {
        const raw = localStorage.getItem(EMBLEM_KEY);
        return raw ? JSON.parse(raw) : {};
    } catch (e) { return {}; }
}

function saveEmblemCounts(counts) {
    localStorage.setItem(EMBLEM_KEY, JSON.stringify(counts));
}

// 3. Render Table
function render() {
    const names = getPlayerNames();
    const counts = getEmblemCounts();
    const container = document.getElementById('tableContent');

    if (names.length === 0) {
        container.innerHTML = `<div class="status-msg">No players found in Dashboard data. Add some in "Add Data".</div>`;
        return;
    }

    let html = `<table>
        <thead>
            <tr>
                <th>Player Name</th>
                <th style="text-align:right">Emblems</th>
            </tr>
        </thead>
        <tbody>`;

    names.forEach(name => {
        const val = counts[name] || 0;
        html += `
            <tr>
                <td class="player-name">${name}</td>
                <td>
                    <div class="count-cell">
                        <button class="btn-sm btn-minus" onclick="updateCount('${name}', -1)">âˆ’</button>
                        <span class="count-val">${val}</span>
                        <button class="btn-sm btn-plus" onclick="updateCount('${name}', 1)">+</button>
                    </div>
                </td>
            </tr>`;
    });

    html += `</tbody></table>`;
    container.innerHTML = html;
}

window.updateCount = function(name, delta) {
    const counts = getEmblemCounts();
    counts[name] = Math.max(0, (counts[name] || 0) + delta);
    saveEmblemCounts(counts);
    render();
};

document.getElementById('darkToggle').onclick = () => {
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
};

if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
render();

// Auto-sync if data changes elsewhere
window.addEventListener('storage', (e) => {
    if (e.key === DATA_KEY || e.key === EMBLEM_KEY) render();
});
</script>
</body>
</html>
