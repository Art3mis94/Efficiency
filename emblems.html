<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Emblem Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{--bg:#f8fafc;--text:#1e293b;--card:#ffffff;--accent:#3b82f6;--muted:#475569;}
body{font-family:Inter,sans-serif;margin:0;background:var(--bg);color:var(--text);transition:all .25s;min-height:100vh;}
body.dark-mode{--bg:#0f172a;--text:#facc15;--card:#111827;--accent:#fbbf24;}

header{background:#1e40af;color:#fff;padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,.08);}
header h1{margin:0;font-size:1.25rem;font-weight:600;}
.toggle-btn{background:none;border:2px solid var(--accent);color:var(--accent);padding:.45rem .7rem;border-radius:8px;cursor:pointer;font-weight:600;}

nav{display:flex;justify-content:center;gap:10px;padding:.75rem;background:#e2e8f0;flex-wrap:wrap;}
nav a{color:#fff;text-decoration:none;padding:.6rem 1rem;background:var(--accent);border-radius:6px;font-weight:600;font-size:0.9rem;}
nav a:hover{opacity:.95;transform:translateY(-1px);}

main{max-width:600px;margin:1.5rem auto;padding:0 1rem;}
.player-card {
    background: var(--card);
    padding: 1.25rem;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.player-info h3 { margin: 0; font-size: 1.1rem; }
.controls { display: flex; align-items: center; gap: 1.2rem; }
.count { font-size: 1.75rem; font-weight: 700; min-width: 50px; text-align: center; }

.btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    font-size: 1.5rem;
    font-weight: bold;
    cursor: pointer;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
}
.btn.minus { background: #ef4444; }
.btn.plus { background: #10b981; }
.btn:hover { opacity: 0.9; }
.btn:active { transform: scale(0.95); }

.status-msg { text-align: center; padding: 3rem; color: var(--muted); background: var(--card); border-radius: 12px; }
</style>
</head>
<body>

<header>
  <h1>Emblem Tracker</h1>
  <button class="toggle-btn" id="darkToggle">Dark Mode</button>
</header>

<nav>
  <a href="index.html">Dashboard</a>
  <a href="trends.html">Trends</a>
  <a href="emblems.html">Emblems</a>
  <a href="form.html">Add Data</a>
  <a href="config.html">Config</a>
</nav>

<main id="emblemList">
    <div class="status-msg">Initialising...</div>
</main>

<script>
const DATA_KEY = 'formData';
const EMBLEM_KEY = 'emblemData';

// 1. SAFELY Get Unique Names from LocalStorage
function getPlayerNames() {
    try {
        const raw = localStorage.getItem(DATA_KEY);
        if (!raw) return [];
        
        const parsed = JSON.parse(raw);
        // Ensure parsed data is actually an array
        if (!Array.isArray(parsed)) return [];

        const names = [...new Set(parsed.map(item => item.name))].filter(Boolean);
        return names.sort();
    } catch (e) {
        console.error("Data Load Error:", e);
        return [];
    }
}

// 2. SAFELY Load Emblem Counts
function getEmblemCounts() {
    try {
        const raw = localStorage.getItem(EMBLEM_KEY);
        return raw ? JSON.parse(raw) : {};
    } catch (e) {
        return {};
    }
}

function saveEmblemCounts(counts) {
    localStorage.setItem(EMBLEM_KEY, JSON.stringify(counts));
}

// 3. Render the list
function render() {
    const names = getPlayerNames();
    const counts = getEmblemCounts();
    const container = document.getElementById('emblemList');

    if (names.length === 0) {
        container.innerHTML = `
            <div class="status-msg">
                <p>No players found in Dashboard data.</p>
                <p style="font-size:0.8rem">Make sure you have added data in the "Add Data" page.</p>
            </div>`;
        return;
    }

    container.innerHTML = names.map(name => {
        const currentCount = counts[name] || 0;
        return `
            <div class="player-card">
                <div class="player-info">
                    <h3>${name}</h3>
                </div>
                <div class="controls">
                    <button class="btn minus" onclick="updateCount('${name}', -1)">âˆ’</button>
                    <div class="count">${currentCount}</div>
                    <button class="btn plus" onclick="updateCount('${name}', 1)">+</button>
                </div>
            </div>
        `;
    }).join('');
}

// 4. Update Function
window.updateCount = function(name, delta) {
    const counts = getEmblemCounts();
    const current = counts[name] || 0;
    counts[name] = Math.max(0, current + delta);
    saveEmblemCounts(counts);
    render();
};

// Dark Mode logic (matches your Dashboard)
document.getElementById('darkToggle').onclick = () => {
  document.body.classList.toggle('dark-mode');
  localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
};

// On Load
if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
render();

// Refresh if data changes in another tab
window.addEventListener('storage', (e) => {
    if (e.key === DATA_KEY || e.key === EMBLEM_KEY) render();
});
</script>
</body>
</html>
