    window.openOverlay = (name) => {
        const data = load();
        const mults = getMults();
        const entries = ['week 1', 'week 2', 'week 3'].map(w => data.find(d => d.name === name && d.week === w) || { week: w });
        
        // Calculate Efficiency for each week to plot in the graph
        const w1 = entries[0];
        currentOverlayData = entries.map(e => {
            let eff = 0;
            if (e.points && w1.points && e.power && e.week !== 'week 1') {
                eff = (parseFloat(e.points) - parseFloat(w1.points)) / parseFloat(e.power);
            }
            return { ...e, efficiency: eff };
        });

        document.getElementById('modalName').textContent = name;
        document.getElementById('ovTableBody').innerHTML = currentOverlayData.map(e => `
            <tr>
                <td>${e.week.toUpperCase()}</td>
                <td>${fmtPower(e.power)}</td>
                <td>${fmt(e.points)}</td>
                <td>${fmt(e.quest)}</td>
                <td>${fmt(e.efficiency)}</td>
                <td>${fmt(e.throne)}</td>
            </tr>`).join('');

        const sel = document.getElementById('chartMetricSelect');
        // Added Efficiency and Quest to the dropdown
        sel.innerHTML = `
            <option value="power">Power</option>
            <option value="points">Points</option>
            <option value="efficiency">Efficiency</option>
            <option value="quest">Quests</option>
        `;
        sel.onchange = updateChartData; // Ensure it triggers on change
        document.getElementById('profileModal').style.display = 'flex';
        updateChartData();
    };

    window.updateChartData = () => {
        const metric = document.getElementById('chartMetricSelect').value;
        const vals = currentOverlayData.map(e => parseFloat(e[metric]) || 0);
        
        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(document.getElementById('playerChart'), {
            type:'line', 
            data:{ 
                labels:['W1','W2','W3'], 
                datasets:[{
                    label: metric.toUpperCase(), 
                    data: vals, 
                    borderColor: '#3b82f6', 
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options:{ 
                maintainAspectRatio: false, 
                scales: { 
                    y: { 
                        beginAtZero: false,
                        ticks: { 
                            callback: v => (metric === 'power' || metric === 'points') ? (v/1000).toFixed(1) + 'Bn' : v.toFixed(2)
                        } 
                    } 
                } 
            }
        });
    };
