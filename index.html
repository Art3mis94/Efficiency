<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Alliance Dashboard - Elite v5</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <!-- style unchanged -->
</head>
<body>
<!-- HTML unchanged -->

<script>
// ... previous variables and functions unchanged ...

window.updateGrowthChart = (metric) => {
    currentMetric = metric;
    const data = JSON.parse(localStorage.getItem('formData') || '[]');
    const compareName = document.getElementById('compareWith').value;
    const weeks = ['week 1', 'week 2', 'week 3'];

    const getPlayerVals = (targetName) => weeks.map(w => {
        const e = data.find(x => x.name === targetName && x.week === w) || { power:0, points:0, quest:0 };
        if (metric === 'eff') return e.power > 0 ? (parseFloat(e.points)/parseFloat(e.power)) : 0;
        return parseFloat(e[metric]) || 0;
    });

    document.querySelectorAll('.c-btn').forEach(b => b.classList.toggle('active', b.id === `btn-${metric}`));

    const datasets = [{ 
        label: activeName, 
        data: getPlayerVals(activeName), 
        borderColor: '#3b82f6', 
        tension: 0.3, 
        fill: true, 
        backgroundColor: 'rgba(59,130,246,0.1)' 
    }];
    if(compareName) datasets.push({ 
        label: compareName, 
        data: getPlayerVals(compareName), 
        borderColor: '#ef4444', 
        tension: 0.3, 
        borderDash: [5,5] 
    });

    if (myChart) myChart.destroy();

    const isPower = metric === 'power';
    myChart = new Chart(document.getElementById('growthChart'), {
        type: 'line',
        data: { labels: ['W1', 'W2', 'W3'], datasets },
        options: { 
            responsive: true, 
            plugins: { legend: { display: !!compareName } },
            scales: {
                y: {
                    ticks: {
                        callback: isPower 
                            ? fmtPowerAxis 
                            : (value) => value.toLocaleString()
                    },
                    title: {
                        display: true,
                        text: isPower ? 'Power (bn)' : metric.charAt(0).toUpperCase() + metric.slice(1),
                        color: '#1e293b',
                        font: { weight: 'bold' }
                    }
                }
            }
        }
    });
};

// rest of the script unchanged
</script>
</body>
</html>