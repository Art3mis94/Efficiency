<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Manage Data</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f1f5f9;--text:#1e293b;--accent:#3b82f6;--success:#10b981;--dark:#1e40af;}
    body{margin:0;font-family:Inter,sans-serif;background:var(--bg);display:flex;height:100vh;}
    .sidebar{width:350px; background:white; border-right:1px solid #e2e8f0; display:flex; flex-direction:column; padding:20px;}
    .main-editor{flex:1; padding:40px; overflow-y:auto;}
    .player-list{list-style:none; padding:0; margin-top:20px; overflow-y:auto;}
    .player-item{padding:12px; border-bottom:1px solid #f1f5f9; cursor:pointer; display:flex; justify-content:space-between; align-items:center; border-radius:8px;}
    .player-item.selected{background:var(--accent); color:white;}
    .rank-stack{text-align:right; line-height:1.2;}
    .rank-tag{font-size:0.65rem; font-weight:800; display:block; opacity:0.8;}
    
    .week-tabs{display:flex; gap:5px; margin-bottom:30px; background:#e2e8f0; padding:5px; border-radius:10px;}
    .tab{flex:1; border:none; padding:10px; cursor:pointer; font-weight:700; border-radius:8px;}
    .tab.active{background:white; color:var(--accent);}

    .form-grid{display:grid; grid-template-columns: 1fr 1fr; gap:20px;}
    .input-group label{display:block; font-size:0.75rem; font-weight:800; color:var(--muted); margin-bottom:8px;}
    .input-group input{width:100%; padding:12px; border:2px solid #cbd5e1; border-radius:8px; font-size:1rem;}
  </style>
</head>
<body>
  <div class="sidebar">
    <h2 style="margin:0 0 15px 0">Members</h2>
    <input type="text" id="pSearch" placeholder="Search roster..." style="padding:10px; border-radius:8px; border:1px solid #cbd5e1;">
    <ul id="pList" class="player-list"></ul>
    <div style="margin-top:auto; padding-top:20px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
      <button onclick="exportCSV()" style="padding:8px; font-size:0.7rem;">Export CSV</button>
      <button onclick="fullWipe()" style="padding:8px; font-size:0.7rem; color:red;">Clear All</button>
    </div>
  </div>

  <div class="main-editor" id="editor" style="opacity:0.5; pointer-events:none;">
    <div class="week-tabs">
      <button class="tab" onclick="setWeek('home week')">HOME</button>
      <button class="tab active" onclick="setWeek('week 1')">WEEK 1</button>
      <button class="tab" onclick="setWeek('week 2')">WEEK 2</button>
      <button class="tab" onclick="setWeek('week 3')">WEEK 3</button>
    </div>
    <h1 id="editTitle">Select a Member</h1>
    <div class="form-grid">
      <div class="input-group"><label>Power</label><input type="number" id="f_power"></div>
      <div class="input-group"><label>Points</label><input type="number" id="f_points"></div>
      <div class="input-group"><label>Picks</label><input type="number" id="f_picks"></div>
      <div class="input-group"><label>Quest</label><input type="number" id="f_quest"></div>
      <div class="input-group"><label>Throne Score</label><input type="number" id="f_throne"></div>
      <div class="input-group"><label>ESI Monday</label><input type="checkbox" id="c_esi_mon"></div>
      <div class="input-group"><label>ESI Wednesday</label><input type="checkbox" id="c_esi_wed"></div>
    </div>
    <button onclick="save()" style="width:100%; margin-top:30px; padding:20px; background:var(--success); color:white; border:none; border-radius:12px; font-weight:800; cursor:pointer;">SAVE CHANGES (ENTER)</button>
  </div>

  <script>
    let curP = null, curW = 'week 1';
    const load = () => JSON.parse(localStorage.getItem('formData') || '[]');
    
    function setWeek(w){
      curW = w;
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.textContent.toLowerCase().includes(w.replace('week ',''))));
      if(curP) selectPlayer(curP);
      renderList();
    }

    function selectPlayer(name){
      curP = name;
      document.getElementById('editor').style.opacity = "1";
      document.getElementById('editor').style.pointerEvents = "auto";
      document.getElementById('editTitle').textContent = name;
      const data = load();
      const entry = data.find(d => d.name === name && d.week === curW) || {};
      
      document.getElementById('f_power').value = entry.power || '';
      document.getElementById('f_points').value = entry.points || '';
      document.getElementById('f_picks').value = entry.picks || '';
      document.getElementById('f_quest').value = entry.quest || '';
      document.getElementById('f_throne').value = entry.throne || '';
      document.getElementById('c_esi_mon').checked = !!entry.esi_mon;
      document.getElementById('c_esi_wed').checked = !!entry.esi_wed;
      
      renderList();
      document.getElementById('f_power').focus();
    }

    function save(){
      if(!curP) return;
      let d = load();
      const idx = d.findIndex(x => x.name === curP && x.week === curW);
      const obj = {
        name: curP, week: curW,
        power: document.getElementById('f_power').value,
        points: document.getElementById('f_points').value,
        picks: document.getElementById('f_picks').value,
        quest: document.getElementById('f_quest').value,
        throne: document.getElementById('f_throne').value,
        esi_mon: document.getElementById('c_esi_mon').checked?1:0,
        esi_wed: document.getElementById('c_esi_wed').checked?1:0
      };
      if(idx > -1) d[idx] = obj; else d.push(obj);
      localStorage.setItem('formData', JSON.stringify(d));
      renderList();
    }

    function renderList(){
      const data = load();
      const weekData = data.filter(d => d.week === curW);
      const ptsSorted = [...weekData].sort((a,b) => (b.points||0) - (a.points||0));
      const picksSorted = [...weekData].sort((a,b) => (b.picks||0) - (a.picks||0));
      
      const names = [...new Set(data.map(d=>d.name))].sort();
      document.getElementById('pList').innerHTML = names.map(n => {
        const pR = ptsSorted.findIndex(x=>x.name===n)+1;
        const kR = picksSorted.findIndex(x=>x.name===n)+1;
        return `<li class="player-item ${n===curP?'selected':''}" onclick="selectPlayer('${n}')">
          <span>${n}</span>
          <div class="rank-stack">
            <span class="rank-tag">PTS: #${pR||'-'}</span>
            <span class="rank-tag">PICKS: #${kR||'-'}</span>
          </div>
        </li>`;
      }).join('');
    }

    window.onload = () => {
      const n = localStorage.getItem('editTargetName');
      const w = localStorage.getItem('editTargetWeek');
      if(n){ if(w) setWeek(w); selectPlayer(n); localStorage.removeItem('editTargetName'); }
      renderList();
    };
    window.addEventListener('keydown', e => { if(e.key==='Enter') save(); });
    renderList();
  </script>
</body>
</html>
