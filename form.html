<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Manage Data</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f1f5f9;--text:#1e293b;--accent:#3b82f6;--success:#10b981;--danger:#ef4444;}
    body{margin:0;font-family:Inter,sans-serif;background:var(--bg);color:var(--text);}
    header{background:#1e40af;color:#fff;padding:1rem 2rem;}
    nav{display:flex;justify-content:center;gap:10px;padding:0.75rem;background:#cbd5e1;}
    nav a{color:#fff;text-decoration:none;padding:.6rem 1.2rem;background:var(--accent);border-radius:8px;font-weight:700;}
    .main-grid{display:grid; grid-template-columns: 300px 1fr; gap:20px; padding:20px;}
    .card{background:white; padding:20px; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.05);}
    .input{width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:8px; margin-bottom:15px; box-sizing:border-box;}
    .week-btn{flex:1; padding:10px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:700;}
    .week-btn.active{background:var(--accent); color:white; border-color:var(--accent);}
    .check-grid{display:grid; grid-template-columns: 1fr 1fr; gap:10px; background:#f8fafc; padding:15px; border-radius:8px; margin-bottom:15px;}
    .btn-save{background:var(--success); color:white; border:none; padding:15px; width:100%; border-radius:8px; font-weight:800; cursor:pointer;}
    .player-list{list-style:none; padding:0; margin:0; height:500px; overflow-y:auto; border:1px solid #eee;}
    .player-list li{padding:10px; border-bottom:1px solid #eee; cursor:pointer;}
    .player-list li:hover{background:#f1f5f9;}
    .player-list li.selected{background:var(--accent); color:white;}
  </style>
</head>
<body>
  <header><h1>Alliance Management</h1></header>
  <nav>
    <a href="index.html">Dashboard</a>
    <a href="trends.html">Trends</a>
    <a href="form.html">Manage Data</a>
  </nav>

  <div class="main-grid">
    <div class="card">
      <h3>Directory</h3>
      <input type="text" id="pSearch" placeholder="Search..." class="input">
      <ul id="pList" class="player-list"></ul>
      <hr>
      <input type="text" id="newName" placeholder="Add member name..." class="input">
      <button onclick="addPlayer()" class="btn-save" style="padding:10px">Add Member</button>
    </div>

    <div class="card">
      <h2 id="editTitle">Select a Member</h2>
      <div style="display:flex; gap:5px; margin-bottom:20px;">
        <button class="week-btn" onclick="setWeek('home week')">HOME</button>
        <button class="week-btn active" onclick="setWeek('week 1')">W1</button>
        <button class="week-btn" onclick="setWeek('week 2')">W2</button>
        <button class="week-btn" onclick="setWeek('week 3')">W3</button>
      </div>

      <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
        <div><label>Power</label><input type="number" id="f_power" class="input"></div>
        <div><label>Points</label><input type="number" id="f_points" class="input"></div>
        <div><label>Quests (Current)</label><input type="number" id="f_quest" class="input"></div>
        <div><label>Throne Score</label><input type="number" id="f_throne" class="input"></div>
        <div><label>Ultimate Hunt</label><input type="number" id="f_hunt" class="input"></div>
      </div>

      <label>Activity & Participation</label>
      <div class="check-grid">
        <label><input type="checkbox" id="c_lava"> Lava</label>
        <label><input type="checkbox" id="c_challenge"> Challenge</label>
        <label><input type="checkbox" id="c_donations"> Donations</label>
        <label><input type="checkbox" id="c_dv"> DV</label>
        <label><input type="checkbox" id="c_esb"> ESB</label>
        <label><input type="checkbox" id="c_esi_mon"> ESI Mon</label>
        <label><input type="checkbox" id="c_esi_thu"> ESI Thu</label>
      </div>

      <button class="btn-save" onclick="save()">SAVE DATA</button>
      <button onclick="deletePlayer()" style="background:none; border:none; color:var(--danger); margin-top:15px; cursor:pointer;">Delete Member</button>
    </div>
  </div>

  <script>
    let curP = null, curW = 'week 1';
    const load = () => JSON.parse(localStorage.getItem('formData') || '[]');
    const saveToLS = (d) => localStorage.setItem('formData', JSON.stringify(d));

    function setWeek(w) {
      curW = w;
      document.querySelectorAll('.week-btn').forEach(b => {
        const txt = b.textContent.toLowerCase();
        b.classList.toggle('active', txt === w.replace('week ','w').toLowerCase() || txt === w);
      });
      if(curP) selectPlayer(curP);
    }

    function selectPlayer(name) {
      curP = name;
      document.getElementById('editTitle').textContent = name + " (" + curW.toUpperCase() + ")";
      const entry = load().find(d => d.name === name && d.week === curW) || {};
      
      document.getElementById('f_power').value = entry.power || '';
      document.getElementById('f_points').value = entry.points || '';
      document.getElementById('f_quest').value = entry.quest || '';
      document.getElementById('f_throne').value = entry.throne || '';
      document.getElementById('f_hunt').value = entry.hunt || '';
      
      ['lava','challenge','donations','dv','esb','esi_mon','esi_thu'].forEach(k => {
        document.getElementById('c_'+k).checked = !!entry[k];
      });
      renderList();
    }

    function save() {
      if(!curP) return;
      let d = load();
      const idx = d.findIndex(x => x.name === curP && x.week === curW);
      const obj = {
        name: curP, week: curW,
        power: document.getElementById('f_power').value,
        points: document.getElementById('f_points').value,
        quest: document.getElementById('f_quest').value,
        throne: document.getElementById('f_throne').value,
        hunt: document.getElementById('f_hunt').value,
        lava: document.getElementById('c_lava').checked?1:0,
        challenge: document.getElementById('c_challenge').checked?1:0,
        donations: document.getElementById('c_donations').checked?1:0,
        dv: document.getElementById('c_dv').checked?1:0,
        esb: document.getElementById('c_esb').checked?1:0,
        esi_mon: document.getElementById('c_esi_mon').checked?1:0,
        esi_thu: document.getElementById('c_esi_thu').checked?1:0
      };
      if(idx > -1) d[idx] = obj; else d.push(obj);
      saveToLS(d);
      alert("Saved!");
    }

    function addPlayer() {
      const n = document.getElementById('newName').value.trim();
      if(!n) return;
      let d = load();
      ['home week','week 1','week 2','week 3'].forEach(w => d.push({name:n, week:w}));
      saveToLS(d);
      document.getElementById('newName').value = '';
      renderList();
    }

    function deletePlayer() {
        if(!curP || !confirm("Delete " + curP + "?")) return;
        saveToLS(load().filter(d => d.name !== curP));
        curP = null;
        renderList();
    }

    function renderList() {
      const s = document.getElementById('pSearch').value.toLowerCase();
      const names = [...new Set(load().map(d => d.name))].sort();
      const ul = document.getElementById('pList');
      ul.innerHTML = names.filter(n => n.toLowerCase().includes(s)).map(n => 
        `<li class="${n===curP?'selected':''}" onclick="selectPlayer('${n.replace(/'/g,"\\'")}')">${n}</li>`
      ).join('');
    }

    document.getElementById('pSearch').oninput = renderList;
    renderList();

    window.onload = () => {
      const t = localStorage.getItem('editTargetName');
      const w = localStorage.getItem('editTargetWeek');
      if(t) {
        if(w) setWeek(w);
        selectPlayer(t);
        localStorage.removeItem('editTargetName');
        localStorage.removeItem('editTargetWeek');
      }
    };
  </script>
</body>
</html>
