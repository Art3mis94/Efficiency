<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alliance Data Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f1f5f9; --text: #1e293b; --accent: #3b82f6; --success: #10b981;
            --dark: #0f172a; --muted: #64748b; --gold: #f59e0b;
        }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 50px; }
        header { background: var(--dark); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        nav { display: flex; justify-content: center; gap: 10px; padding: .75rem; background: #e2e8f0; }
        nav a { color: #fff; text-decoration: none; padding: .5rem 1rem; background: var(--accent); border-radius: 6px; font-weight: 700; }
        
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,.05); margin-bottom: 20px; }
        h3 { margin-top: 0; font-weight: 800; font-size: 1rem; text-transform: uppercase; color: var(--muted); letter-spacing: 0.5px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .field { display: flex; flex-direction: column; gap: 5px; margin-bottom: 15px; }
        label { font-size: .75rem; font-weight: 700; color: var(--muted); }
        input, select { padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0; font-family: inherit; font-size: 0.9rem; }
        
        /* Flip Card Styling */
        .flip-container { perspective: 1000px; min-height: 160px; }
        .flipper { transition: 0.6s; transform-style: preserve-3d; position: relative; width: 100%; height: 100%; }
        .flipped { transform: rotateY(180deg); }
        .front, .back { backface-visibility: hidden; width: 100%; position: absolute; top: 0; left: 0; background: white; }
        .back { transform: rotateY(180deg); }

        .king-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding-top: 10px; }
        .btn-save { width: 100%; padding: 15px; background: var(--success); color: white; border: none; border-radius: 12px; font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        .btn-save:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .toggle-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
        .toggle-item { flex: 1; min-width: 80px; }
        .toggle-item input { display: none; }
        .toggle-item label { display: block; padding: 8px; background: #f1f5f9; border-radius: 8px; text-align: center; cursor: pointer; font-weight: 700; transition: 0.2s; color: var(--text); }
        .toggle-item input:checked + label { background: var(--accent); color: white; }
    </style>
</head>
<body>

<header><h1>Management</h1></header>
<nav>
    <a href="index.html">Dashboard</a>
    <a href="trends.html">Trends</a>
    <a href="form.html">Manage Data</a>
</nav>

<div class="container">
    <div class="card">
        <h3>Primary Identity</h3>
        <div class="grid">
            <div class="field">
                <label>Member Name</label>
                <input type="text" id="memberName" list="nameList" placeholder="Type or select name...">
                <datalist id="nameList"></datalist>
            </div>
            <div class="field">
                <label>Target Week</label>
                <select id="weekSelect">
                    <option value="home week">HOME WEEK</option>
                    <option value="week 1">WEEK 1</option>
                    <option value="week 2">WEEK 2</option>
                    <option value="week 3">WEEK 3</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>Activity Toggles</h3>
        <div class="toggle-group">
            <div class="toggle-item"><input type="checkbox" id="lava"><label for="lava">LAVA</label></div>
            <div class="toggle-item"><input type="checkbox" id="challenge"><label for="challenge">CHALL</label></div>
            <div class="toggle-item"><input type="checkbox" id="donations"><label for="donations">DONO</label></div>
            <div class="toggle-item"><input type="checkbox" id="esb"><label for="esb">ESB</label></div>
            <div class="toggle-item"><input type="checkbox" id="dv"><label for="dv">DV</label></div>
            <div class="toggle-item"><input type="checkbox" id="mon"><label for="mon">MON</label></div>
            <div class="toggle-item"><input type="checkbox" id="wed"><label for="wed">WED</label></div>
        </div>
        <h3 style="margin-top:20px;">Hero Picks</h3>
        <div class="toggle-group">
            <div class="toggle-item"><input type="checkbox" id="p100"><label for="p100">100</label></div>
            <div class="toggle-item"><input type="checkbox" id="p40"><label for="p40">40</label></div>
            <div class="toggle-item"><input type="checkbox" id="p20"><label for="p20">20</label></div>
            <div class="toggle-item"><input type="checkbox" id="p5"><label for="p5">5</label></div>
        </div>
    </div>

    <div class="card">
        <div class="grid">
            <div class="field"><label>Power</label><input type="number" id="power"></div>
            <div class="field"><label>Points</label><input type="number" id="points"></div>
            <div class="field"><label>Hunt</label><input type="number" id="hunt"></div>
            <div class="field"><label>Quest</label><input type="number" id="quest"></div>
            <div class="field"><label>Throne</label><input type="number" id="throne"></div>
        </div>
    </div>

    <div class="card" style="overflow: hidden;">
        <div class="flip-container">
            <div class="flipper" id="flipper">
                <div class="front">
                    <h3 onclick="toggleFlip()" style="cursor:pointer; color:var(--accent);">ðŸ“Š Live Analysis (Click to Flip)</h3>
                    <div id="liveAnalysis" style="font-size: 0.85rem; color: var(--muted); padding-top:10px;">
                        Enter data to see breakdown...
                    </div>
                </div>
                <div class="back">
                    <h3 onclick="toggleFlip()" style="cursor:pointer; color:var(--gold);">ðŸ‘‘ King Pack (Click to Flip)</h3>
                    <div class="king-grid">
                        <div class="field">
                            <label>Pack Quality</label>
                            <select id="kingPackType">
                                <option value="none">None</option>
                                <option value="legendary">Legendary</option>
                                <option value="epic">Epic</option>
                                <option value="excellent">Excellent</option>
                                <option value="rare_dragon">Rare (Dragon)</option>
                                <option value="rare_hero">Rare (Hero)</option>
                                <option value="rare_units">Rare (Units)</option>
                            </select>
                        </div>
                        <div class="field">
                            <label>Throne Ticks</label>
                            <div style="display:flex; gap:10px; padding-top:5px;">
                                <label><input type="checkbox" id="throne1"> T1</label>
                                <label><input type="checkbox" id="throne2"> T2</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="btn-save" onclick="saveData()">SAVE PLAYER DATA</button>
</div>

<script>
    const fields = ['power', 'points', 'hunt', 'quest', 'throne', 'lava', 'challenge', 'donations', 'esb', 'dv', 'mon', 'wed', 'p100', 'p40', 'p20', 'p5', 'kingPackType', 'throne1', 'throne2'];

    const loadData = () => JSON.parse(localStorage.getItem('formData') || '[]');

    const populateNameList = () => {
        const data = loadData();
        const names = [...new Set(data.map(d => d.name))];
        document.getElementById('nameList').innerHTML = names.map(n => `<option value="${n}">`).join('');
    };

    function toggleFlip() {
        document.getElementById('flipper').classList.toggle('flipped');
    }

    const syncForm = () => {
        const name = document.getElementById('memberName').value;
        const week = document.getElementById('weekSelect').value;
        const data = loadData();
        const entry = data.find(d => d.name === name && d.week === week) || {};

        fields.forEach(f => {
            const el = document.getElementById(f);
            if (el.type === 'checkbox') el.checked = entry[f] === 1;
            else el.value = entry[f] || (el.tagName === 'SELECT' ? (f === 'kingPackType' ? 'none' : '') : '');
        });
        updateAnalysis();
    };

    const saveData = () => {
        const name = document.getElementById('memberName').value;
        const week = document.getElementById('weekSelect').value;
        if (!name) return alert("Please enter a name");

        let data = loadData();
        const entry = { name, week };
        fields.forEach(f => {
            const el = document.getElementById(f);
            entry[f] = el.type === 'checkbox' ? (el.checked ? 1 : 0) : el.value;
        });

        const idx = data.findIndex(d => d.name === name && d.week === week);
        if (idx > -1) data[idx] = entry; else data.push(entry);

        localStorage.setItem('formData', JSON.stringify(data));
        alert("Data Saved!");
        populateNameList();
        updateAnalysis();
    };

    const updateAnalysis = () => {
        const p = parseFloat(document.getElementById('power').value) || 0;
        const pts = parseFloat(document.getElementById('points').value) || 0;
        const analysis = document.getElementById('liveAnalysis');
        if (!p || !pts) { analysis.innerHTML = "Awaiting valid power/points data..."; return; }
        
        const eff = (pts / (p / 1000000)).toFixed(2);
        analysis.innerHTML = `<strong>Efficiency:</strong> ${eff} pts/m power<br><strong>Current Status:</strong> Data ready for dashboard.`;
    };

    // Initialization
    document.getElementById('memberName').addEventListener('input', syncForm);
    document.getElementById('weekSelect').addEventListener('change', syncForm);
    fields.forEach(f => document.getElementById(f).addEventListener('input', updateAnalysis));

    // Handle Edit Redirects
    const editName = localStorage.getItem('editTargetName');
    const editWeek = localStorage.getItem('editTargetWeek');
    if(editName) {
        document.getElementById('memberName').value = editName;
        document.getElementById('weekSelect').value = editWeek;
        localStorage.removeItem('editTargetName');
        localStorage.removeItem('editTargetWeek');
        syncForm();
    }

    populateNameList();
</script>

</body>
</html>
