<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Alliance Data Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #f1f5f9; --text: #1e293b; --accent: #3b82f6; --success: #10b981;
            --dark: #0f172a; --muted: #64748b; --gold: #f59e0b;
        }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding-bottom: 50px; }
        header { background: var(--dark); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; }
        nav { display: flex; justify-content: center; gap: 10px; padding: .75rem; background: #e2e8f0; }
        nav a { color: #fff; text-decoration: none; padding: .5rem 1rem; background: var(--accent); border-radius: 6px; font-weight: 700; }
        
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 15px rgba(0,0,0,.05); margin-bottom: 20px; }
        h3 { margin-top: 0; font-weight: 800; font-size: 1rem; text-transform: uppercase; color: var(--muted); letter-spacing: 0.5px; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .field { display: flex; flex-direction: column; gap: 5px; margin-bottom: 15px; }
        label { font-size: .75rem; font-weight: 700; color: var(--muted); }
        input, select { padding: 12px; border-radius: 10px; border: 1px solid #e2e8f0; font-family: inherit; font-size: 0.9rem; }
        
        .btn-save { width: 100%; padding: 15px; background: var(--success); color: white; border: none; border-radius: 12px; font-weight: 800; font-size: 1rem; cursor: pointer; transition: 0.2s; }
        .btn-save:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .toggle-group { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
        .toggle-item { flex: 1; min-width: 80px; }
        .toggle-item input { display: none; }
        .toggle-item label { display: block; padding: 8px; background: #f1f5f9; border-radius: 8px; text-align: center; cursor: pointer; font-weight: 700; transition: 0.2s; color: var(--text); }
        .toggle-item input:checked + label { background: var(--accent); color: white; }

        /* King Pack List Styles */
        .king-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .king-table th { text-align: left; font-size: 0.65rem; color: var(--muted); padding-bottom: 10px; border-bottom: 1px solid #f1f5f9; }
        .king-table td { padding: 10px 0; border-bottom: 1px solid #f8fafc; font-size: 0.85rem; font-weight: 600; }
        .king-table input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        .center { text-align: center; }
    </style>
</head>
<body>

<header><h1>Management</h1></header>
<nav>
    <a href="index.html">Dashboard</a>
    <a href="trends.html">Trends</a>
    <a href="form.html">Manage Data</a>
</nav>

<div class="container">
    <div class="card">
        <h3>Primary Identity</h3>
        <div class="grid">
            <div class="field">
                <label>Member Name</label>
                <input type="text" id="memberName" list="nameList" placeholder="Type or select name...">
                <datalist id="nameList"></datalist>
            </div>
            <div class="field">
                <label>Target Week</label>
                <select id="weekSelect">
                    <option value="home week">HOME WEEK</option>
                    <option value="week 1">WEEK 1</option>
                    <option value="week 2">WEEK 2</option>
                    <option value="week 3">WEEK 3</option>
                </select>
            </div>
        </div>
    </div>

    <div class="card">
        <h3>Activity Toggles</h3>
        <div class="toggle-group">
            <div class="toggle-item"><input type="checkbox" id="lava"><label for="lava">LAVA</label></div>
            <div class="toggle-item"><input type="checkbox" id="challenge"><label for="challenge">CHALL</label></div>
            <div class="toggle-item"><input type="checkbox" id="donations"><label for="donations">DONO</label></div>
            <div class="toggle-item"><input type="checkbox" id="esb"><label for="esb">ESB</label></div>
            <div class="toggle-item"><input type="checkbox" id="dv"><label for="dv">DV</label></div>
            <div class="toggle-item"><input type="checkbox" id="mon"><label for="mon">MON</label></div>
            <div class="toggle-item"><input type="checkbox" id="wed"><label for="wed">WED</label></div>
        </div>
        <h3 style="margin-top:20px;">Hero Picks</h3>
        <div class="toggle-group">
            <div class="toggle-item"><input type="checkbox" id="p100"><label for="p100">100</label></div>
            <div class="toggle-item"><input type="checkbox" id="p40"><label for="p40">40</label></div>
            <div class="toggle-item"><input type="checkbox" id="p20"><label for="p20">20</label></div>
            <div class="toggle-item"><input type="checkbox" id="p5"><label for="p5">5</label></div>
        </div>
    </div>

    <div class="card">
        <div class="grid">
            <div class="field"><label>Power</label><input type="number" id="power"></div>
            <div class="field"><label>Points</label><input type="number" id="points"></div>
            <div class="field"><label>Hunt</label><input type="number" id="hunt"></div>
            <div class="field"><label>Quest</label><input type="number" id="quest"></div>
            <div class="field"><label>Throne</label><input type="number" id="throne"></div>
        </div>
    </div>

    <div class="card">
        <h3 id="analysisHeader" onclick="toggleKingMode()" style="cursor:pointer; color:var(--accent); display: flex; justify-content: space-between; align-items: center;">
            <span id="headerTitle">ðŸ“Š LIVE ANALYSIS</span>
            <span style="font-size: 0.65rem; color: var(--muted); font-weight: 400;">CLICK TO TRACK KING PACK ðŸ‘‘</span>
        </h3>
        
        <div id="analysisContent">
            <div id="scoreView" style="font-size: 0.85rem; color: var(--muted); padding-top:10px;">
                Enter player metrics to see efficiency breakdown...
            </div>

            <div id="kingView" style="display:none;">
                <table class="king-table">
                    <thead>
                        <tr>
                            <th>KING PACK TYPE</th>
                            <th class="center">T1</th>
                            <th class="center">T2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>Legendary</td><td class="center"><input type="checkbox" id="leg_t1"></td><td class="center"><input type="checkbox" id="leg_t2"></td></tr>
                        <tr><td>Epic (hero)</td><td class="center"><input type="checkbox" id="epi_t1"></td><td class="center"><input type="checkbox" id="epi_t2"></td></tr>
                        <tr><td>Excellent (units)</td><td class="center"><input type="checkbox" id="exc_t1"></td><td class="center"><input type="checkbox" id="exc_t2"></td></tr>
                        <tr><td>Rare (dragon)</td><td class="center"><input type="checkbox" id="rdra_t1"></td><td class="center"><input type="checkbox" id="rdra_t2"></td></tr>
                        <tr><td>Rare (hero)</td><td class="center"><input type="checkbox" id="rher_t1"></td><td class="center"><input type="checkbox" id="rher_t2"></td></tr>
                        <tr><td>Rare (units)</td><td class="center"><input type="checkbox" id="runi_t1"></td><td class="center"><input type="checkbox" id="runi_t2"></td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <button class="btn-save" onclick="saveData()">SAVE PLAYER DATA</button>
</div>

<script>
    const fields = [
        'power', 'points', 'hunt', 'quest', 'throne', 
        'lava', 'challenge', 'donations', 'esb', 'dv', 'mon', 'wed', 
        'p100', 'p40', 'p20', 'p5',
        'leg_t1', 'leg_t2', 'epi_t1', 'epi_t2', 'exc_t1', 'exc_t2',
        'rdra_t1', 'rdra_t2', 'rher_t1', 'rher_t2', 'runi_t1', 'runi_t2'
    ];

    const loadData = () => JSON.parse(localStorage.getItem('formData') || '[]');

    const populateNameList = () => {
        const data = loadData();
        const names = [...new Set(data.map(d => d.name))];
        document.getElementById('nameList').innerHTML = names.map(n => `<option value="${n}">`).join('');
    };

    function toggleKingMode() {
        const scoreView = document.getElementById('scoreView');
        const kingView = document.getElementById('kingView');
        const title = document.getElementById('headerTitle');

        if (kingView.style.display === 'none') {
            kingView.style.display = 'block';
            scoreView.style.display = 'none';
            title.innerText = "ðŸ‘‘ KING PACK TRACKER";
            title.style.color = "var(--gold)";
        } else {
            kingView.style.display = 'none';
            scoreView.style.display = 'block';
            title.innerText = "ðŸ“Š LIVE ANALYSIS";
            title.style.color = "var(--accent)";
        }
    }

    const syncForm = () => {
        const name = document.getElementById('memberName').value;
        const week = document.getElementById('weekSelect').value;
        const data = loadData();
        const entry = data.find(d => d.name === name && d.week === week) || {};

        fields.forEach(f => {
            const el = document.getElementById(f);
            if (!el) return;
            if (el.type === 'checkbox') el.checked = entry[f] === 1;
            else el.value = entry[f] || '';
        });
        updateAnalysis();
    };

    const saveData = () => {
        const name = document.getElementById('memberName').value;
        const week = document.getElementById('weekSelect').value;
        if (!name) return alert("Please enter a name");

        let data = loadData();
        const entry = { name, week };
        fields.forEach(f => {
            const el = document.getElementById(f);
            if (!el) return;
            entry[f] = el.type === 'checkbox' ? (el.checked ? 1 : 0) : el.value;
        });

        const idx = data.findIndex(d => d.name === name && d.week === week);
        if (idx > -1) data[idx] = entry; 
        else data.push(entry);

        localStorage.setItem('formData', JSON.stringify(data));
        alert(`${name} - ${week.toUpperCase()} saved!`);
        populateNameList();
        updateAnalysis();
    };

    const updateAnalysis = () => {
        const p = parseFloat(document.getElementById('power').value) || 0;
        const pts = parseFloat(document.getElementById('points').value) || 0;
        const analysis = document.getElementById('scoreView');
        if (!p || !pts) { analysis.innerHTML = "Awaiting data..."; return; }
        const eff = (pts / (p / 1000000)).toFixed(2);
        analysis.innerHTML = `<strong>Efficiency:</strong> ${eff} pts/m power.`;
    };

    document.getElementById('memberName').addEventListener('input', syncForm);
    document.getElementById('weekSelect').addEventListener('change', syncForm);
    ['power', 'points'].forEach(id => document.getElementById(id).addEventListener('input', updateAnalysis));

    const editName = localStorage.getItem('editTargetName');
    const editWeek = localStorage.getItem('editTargetWeek');
    if(editName) {
        document.getElementById('memberName').value = editName;
        document.getElementById('weekSelect').value = editWeek;
        localStorage.removeItem('editTargetName');
        localStorage.removeItem('editTargetWeek');
        syncForm();
    }
    populateNameList();
</script>
</body>
</html>
