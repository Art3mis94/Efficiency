<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Alliance Manager - Live Rank</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- rest of your <style> unchanged -->
</head>
<body>

<header><h1>Alliance Management</h1><div id="rosterCount">0 Players</div></header>
<nav><a href="index.html">Dashboard</a><a href="trends.html">Trends</a><a href="form.html">Manage Data</a></nav>

<main class="main-wrap">
    <section class="section">
        <h3>Directory</h3>
        <input type="text" id="playerSearch" placeholder="ðŸ” Search..." class="input" oninput="renderList()">
        <ul class="players-list" id="playersList"></ul>
        <textarea id="bulkInput" placeholder="Bulk Add Names" class="input" style="margin-top:15px;" rows="3"></textarea>
        <button class="btn" style="background:var(--success)" onclick="addNewPlayer()">Add Players</button>

        <!-- New management buttons -->
        <div style="margin-top:20px; display:grid; gap:8px;">
            <button class="btn" style="background:#f59e0b" onclick="exportCSV()">Export CSV</button>
            <input type="file" id="importCSV" accept=".csv" style="display:none" onchange="importCSV(event)">
            <button class="btn" style="background:#f59e0b" onclick="document.getElementById('importCSV').click()">Import CSV</button>
            <button class="btn" style="background:var(--danger)" onclick="clearAllPlayerData()">Clear All Data</button>
            <button class="btn" style="background:#991b1b" onclick="deleteAllPlayers()">Delete All Players</button>
        </div>
    </section>

    <!-- rest of your middle + right sections unchanged -->

</main>

<script>
// Your existing variables and functions remain identical until here

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// NEW FUNCTIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function exportCSV() {
    const db = loadDB();
    if (!db.length) return alert("No data to export");

    const headers = ['name','week', ...fKeys, ...tKeys];
    const rows = db.map(row => 
        headers.map(h => 
            row[h] == null ? "" : 
            typeof row[h] === 'string' ? `"${row[h].replace(/"/g,'""')}"` : row[h]
        ).join(',')
    );

    const csv = [headers.join(','), ...rows].join('\n');
    const blob = new Blob([csv], {type: 'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `alliance_data_${new Date().toISOString().slice(0,10)}.csv`;
    a.click();
    URL.revokeObjectURL(url);
}

function importCSV(e) {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
        const text = ev.target.result;
        const lines = text.trim().split('\n').map(l => l.trim());
        if (lines.length < 2) return alert("File appears empty or invalid");

        const headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g,''));
        const data = [];

        for (let i = 1; i < lines.length; i++) {
            let row = [];
            let current = '';
            let inQuote = false;

            for (let char of lines[i] + ',') {
                if (char === '"' && !inQuote) { inQuote = true; continue; }
                if (char === '"' && inQuote)  { inQuote = false; continue; }
                if (char === ',' && !inQuote) {
                    row.push(current.trim().replace(/""/g,'"'));
                    current = '';
                    continue;
                }
                current += char;
            }

            if (row.length !== headers.length) continue;

            const obj = {};
            headers.forEach((h, idx) => {
                let val = row[idx];
                if (fKeys.includes(h) || tKeys.includes(h)) {
                    val = parseFloat(val) || (val === '1' ? 1 : 0);
                }
                obj[h] = val;
            });

            if (obj.name && obj.week) data.push(obj);
        }

        if (!data.length) return alert("No valid rows found");

        let db = loadDB();
        const existing = new Map(db.map(e => [`${e.name}|${e.week}`, e]));

        data.forEach(newEntry => {
            const key = `${newEntry.name}|${newEntry.week}`;
            existing.set(key, newEntry);
        });

        saveDB(Array.from(existing.values()));
        renderList();
        alert(`Imported/updated ${data.length} entries`);
    };
    reader.readAsText(file);
}

function clearAllPlayerData() {
    if (!confirm("Reset ALL player stats to zero for EVERY week?\nThis cannot be undone.")) return;
    let db = loadDB();
    db = db.map(entry => {
        const reset = {name: entry.name, week: entry.week};
        fKeys.forEach(k => reset[k] = "");
        tKeys.forEach(k => reset[k] = 0);
        return reset;
    });
    saveDB(db);
    if (curP) selectPlayer(curP);
    renderList();
    alert("All player data cleared (stats reset to zero).");
}

function deleteAllPlayers() {
    if (!confirm("DELETE ALL players and ALL their data permanently?\nThis cannot be undone.")) return;
    saveDB([]);
    curP = null;
    curW = 'week 1';
    setWeek('week 1');
    renderList();
    alert("All players deleted.");
}

// Your existing functions (loadDB, saveDB, setWeek, selectPlayer, updateLive, saveEntry, addNewPlayer, renderList) remain unchanged

// Initial load
const tName = localStorage.getItem('editTargetName');
if (tName) {
    localStorage.removeItem('editTargetName');
    setWeek(localStorage.getItem('editTargetWeek') || 'week 1');
    selectPlayer(tName);
} else {
    setWeek('week 1');
}
</script>
</body>
</html>