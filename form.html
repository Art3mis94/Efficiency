<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Manage Data</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f1f5f9;--text:#1e293b;--accent:#3b82f6;--success:#10b981;--dark:#1e40af;}
    body{margin:0;font-family:Inter,sans-serif;background:var(--bg);display:flex;height:100vh;}
    .sidebar{width:380px; background:white; border-right:1px solid #e2e8f0; display:flex; flex-direction:column; padding:20px;}
    .main-editor{flex:1; padding:40px; overflow-y:auto;}
    .player-item{padding:12px; border-bottom:1px solid #f1f5f9; cursor:pointer; display:flex; justify-content:space-between; align-items:center; border-radius:8px;}
    .player-item.selected{background:var(--accent); color:white;}
    .pick-green{color:var(--success) !important; font-weight:bold;}
    .week-tabs{display:flex; gap:5px; margin-bottom:30px; background:#e2e8f0; padding:5px; border-radius:10px;}
    .tab{flex:1; border:none; padding:10px; cursor:pointer; font-weight:700; border-radius:8px;}
    .tab.active{background:white; color:var(--accent);}
    .pick-grid{display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; background:#f8fafc; padding:15px; border-radius:12px; margin:20px 0;}
    input{width:100%; padding:10px; border:2px solid #cbd5e1; border-radius:8px; margin-bottom:10px;}
    label{font-size:0.7rem; font-weight:800; color:var(--muted); text-transform:uppercase;}
  </style>
</head>
<body>
  <div class="sidebar">
    <h2>Roster</h2>
    <input type="text" id="pSearch" placeholder="Search..." oninput="renderList()">
    <ul id="pList" style="list-style:none; padding:0; overflow-y:auto; flex:1;"></ul>
    <button onclick="exportCSV()">Export CSV</button>
  </div>

  <div class="main-editor" id="editor" style="opacity:0.5; pointer-events:none;">
    <div class="week-tabs">
      <button class="tab" onclick="setWeek('home week')">HOME</button>
      <button class="tab" onclick="setWeek('week 1')">W1</button>
      <button class="tab" onclick="setWeek('week 2')">W2</button>
      <button class="tab" onclick="setWeek('week 3')">W3</button>
    </div>
    <h1 id="editTitle">Select Member</h1>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px;">
      <div><label>Power</label><input type="number" id="f_power"></div>
      <div><label>Points</label><input type="number" id="f_points"></div>
    </div>
    <label>Hero Picks (Current Week)</label>
    <div class="pick-grid">
      <div><label>100s</label><input type="number" id="f_p100"></div>
      <div><label>40s</label><input type="number" id="f_p40"></div>
      <div><label>20s</label><input type="number" id="f_p20"></div>
      <div><label>5s</label><input type="number" id="f_p5"></div>
    </div>
    <button onclick="save()" style="width:100%; padding:20px; background:var(--success); color:white; border:none; border-radius:12px; font-weight:800; cursor:pointer;">SAVE (ENTER)</button>
  </div>

  <script>
    let curP = null, curW = 'week 1';
    const load = () => JSON.parse(localStorage.getItem('formData') || '[]');
    
    function setWeek(w){
      curW = w;
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.textContent.toLowerCase().includes(w.replace('week ',''))));
      if(curP) selectPlayer(curP);
      renderList();
    }

    function selectPlayer(name){
      curP = name;
      document.getElementById('editor').style.opacity = "1";
      document.getElementById('editor').style.pointerEvents = "auto";
      document.getElementById('editTitle').textContent = name;
      const entry = load().find(d => d.name === name && d.week === curW) || {};
      ['power','points','p100','p40','p20','p5'].forEach(f => document.getElementById('f_'+f).value = entry[f] || '');
      renderList();
    }

    function save(){
      if(!curP) return;
      let d = load();
      const idx = d.findIndex(x => x.name === curP && x.week === curW);
      const obj = { name: curP, week: curW, power: document.getElementById('f_power').value, points: document.getElementById('f_points').value, p100: document.getElementById('f_p100').value, p40: document.getElementById('f_p40').value, p20: document.getElementById('f_p20').value, p5: document.getElementById('f_p5').value };
      if(idx > -1) d[idx] = obj; else d.push(obj);
      localStorage.setItem('formData', JSON.stringify(d));
      renderList();
    }

    function renderList(){
      const data = load();
      const search = document.getElementById('pSearch').value.toLowerCase();
      const names = [...new Set(data.map(d=>d.name))].sort();
      const weekData = data.filter(d => d.week === curW);
      
      document.getElementById('pList').innerHTML = names.filter(n => n.toLowerCase().includes(search)).map(n => {
        const entries = data.filter(e => e.name === n);
        const hasAHundred = entries.some(e => (parseFloat(e.p100)||0) > 0);
        const curEntry = entries.find(e => e.week === curW) || {};
        const picks = (parseFloat(curEntry.p100)||0) + (parseFloat(curEntry.p40)||0) + (parseFloat(curEntry.p20)||0) + (parseFloat(curEntry.p5)||0);

        return `<li class="player-item ${n===curP?'selected':''}" onclick="selectPlayer('${n}')">
          <span>${n}</span>
          <span class="${hasAHundred ? 'pick-green' : ''}">${picks}</span>
        </li>`;
      }).join('');
    }

    window.onload = () => {
      const n = localStorage.getItem('editTargetName'), w = localStorage.getItem('editTargetWeek');
      if(n){ if(w) setWeek(w); selectPlayer(n); localStorage.removeItem('editTargetName'); }
    };
    window.addEventListener('keydown', e => { if(e.key==='Enter') save(); });
    renderList();
  </script>
</body>
</html>
